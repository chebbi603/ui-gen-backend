# Canonical Contract Structure Reference

This document describes the expected shape of a canonical UX contract generated by the backend `ContractBuilderService` and validated by `ContractValidator`.

## Top-Level Sections
- `meta`: App metadata, including `appName`, `version` (semver), `schemaVersion`, `generatedAt`.
- `dataModels`: Map of models with `primaryKey` and `fields` definitions.
- `services`: Array of service configs with `name`, `baseUrl`, and `endpoints`.
  - Endpoint fields (canonical): `path`, `method`, `auth`, `queryParams`, `requestSchema`, `responseSchema`, `caching`, `retryPolicy`.
  - Synonyms accepted by parser but discouraged: `authRequired` (use `auth`), `params` (use `queryParams`), `response` (use `responseSchema`), `retry` (use `retryPolicy`).
- `pagesUI`: UI configuration including `routes`, `bottomNavigation`, and `pages`.
- `state`: Global and per-page state definitions with `type` and `persistence`.
- `themingAccessibility`: Theme tokens for `light` and `dark` modes used via `${theme.*}` references.

## Pages
- Each page has `id`, `title`, `scope` (`public` or `authenticated`), `layout` (`center` or `scroll`), `style` with `backgroundColor` that must be a theme token.
- `children`: Array of UI components. Common types: `text`, `card`, `image`, `list`, `row`, `column`, `form`.
- Components may include `binding` strings like `${state.someKey}` and `dependencies` array listing required state keys.

## Routes and Navigation
- `pagesUI.routes`: Map of route path to `{ pageId, auth, description }`.
- `pagesUI.bottomNavigation`: `{ enabled, authRequired, items: [{ label, icon, route }] }`.

## State
- `state.global`: Global state keys, e.g., `authToken`, `selectedCategory`. Persistence: `secure`, `session`, `local`, or `memory`.
- `state.pages`: Per-page state map keyed by page id.

## Theming and Accessibility
- All colors should use `${theme.*}` tokens. Direct hex values are disallowed by design validation.
- Theme tokens available are defined under `themingAccessibility.light` and `.dark`.

## Builder Conventions
- Pages created with `createPage(id, title, layout, authRequired)` automatically:
  - Register a route inferred from `id`.
  - Add bottom navigation items for authenticated pages.
  - Initialize per-page state map.
- `addCard(title?, children?, elevation?, padding?)` creates consistent card components using design system defaults.
- `addList(id, staticDataArray?, paginationEnabled?)` adds lists; static lists disable pagination.
- `addImage(seedOrUrl, width?, height?)` inserts images with validation of URL format.
- `addBinding(stateKey, componentIds)` ensures the state key exists and attaches `${state.key}` bindings.

## Validation
- Backend validation (`ContractValidator`) ensures required sections, supported components/actions, services schema, state configuration, and cross references.
- Design validation (`ContractDesignValidatorService`) enforces UI rules:
  - Pages must have `style.backgroundColor` using `${theme.*}`.
  - No direct hex colors in component styles.
  - `textField` components require `placeholder`.
  - Static lists must set `pagination.enabled = false`.
  - Image URLs must be `http(s)`.

This document is the canonical reference used when designing or reviewing builder-generated contracts.